<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Muganga AI Admin</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }

    .topnav {
      background-color: #007bff;
      color: white;
      padding: 1rem 3rem;
      font-size: 1.5rem;
      position: relative;
      text-align: center;
    }

    .topnav-title {
      margin-left: 2.5rem;
    }

    .container {
      display: flex;
      flex: 1;
    }

    .sidenav {
      background-color: #f4f4f4;
      padding: 1rem;
      width: 200px;
      min-height: 100vh;
      transition: transform 0.3s ease-in-out;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    }

    .sidenav a {
      display: block;
      margin: 0.2rem 0;
      padding: 0.4rem 0.6rem;
      text-decoration: none;
      color: #333;
      border-radius: 5px;
      transition: background 0.3s;
    }

    .sidenav a:hover {
      background-color: #ddd;
    }

    .main {
      flex: 1;
      padding: 1rem;
    }

    .hamburger {
      display: none;
      font-size: 1.5rem;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      position: absolute;
      left: 1rem;
      top: 1rem;
      z-index: 1100;
    }

    @media (max-width: 768px) {
      .sidenav {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        transform: translateX(-100%);
        z-index: 1000;
        width: 200px;
      }

      .sidenav.active {
        transform: translateX(0);
      }

      .hamburger {
        display: block;
      }
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 10px;
      border: 1px solid #ccc;
    }

    button {
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="topnav">
    <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
    <span class="topnav-title">Muganga AI Admin Dashboard</span>
  </div>

  <div class="container">
    <div class="sidenav" id="sidenav">
      <a href="#" onclick="switchSection(loadOverview)">üè† Dashboard</a>
      <a href="#" onclick="switchSection(loadUsers)">üë• Users</a>
      <a href="#" onclick="switchSection(loadAdmins)">üõ†Ô∏è Admins</a>
      <a href="#" onclick="switchSection(loadRecords)">üìã Records</a>
      <a href="#" onclick="switchSection(loadCritical)">üö® Critical</a>
      <a href="#" onclick="switchSection(loadComments)">üí¨ Comments</a>
      <a href="#" onclick="logout()">üö™ Logout</a>
    </div>

    <div class="main" id="main">
      <h2>Welcome to Muganga AI Admin Panel</h2>
      <p>Select a menu item to begin.</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDXFeOehYhT-bU4AVz6EvINJxNRhKibVvI",
      authDomain: "muganga-ai.firebaseapp.com",
      projectId: "muganga-ai",
      storageBucket: "muganga-ai.appspot.com",
      messagingSenderId: "724469912167",
      appId: "1:724469912167:web:3fd118eeb5421c9b28d9b4",
      measurementId: "G-05KYQ9S7QZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.loadOverview = function () {
      document.getElementById("main").innerHTML = "<h2>Dashboard Overview</h2><p>Summary of statistics here...</p>";
    };

    window.loadUsers = async function () {
      const main = document.getElementById("main");
      main.innerHTML = "<h2>Users</h2><p>Loading users...</p>";

      try {
        const usersRef = collection(db, "users");
        const snapshot = await getDocs(usersRef);

        if (snapshot.empty) {
          main.innerHTML = "<h2>Users</h2><p>No users found.</p>";
          return;
        }

        let html = "<h2>Users</h2><table><tr><th>Name</th><th>Email</th><th>Role</th></tr>";
        snapshot.forEach(doc => {
          const data = doc.data();
          html += `<tr><td>${data.name || "Unknown"}</td><td>${data.email || "N/A"}</td><td>${data.role || "User"}</td></tr>`;
        });
        html += "</table>";
        main.innerHTML = html;

      } catch (error) {
        main.innerHTML = `<h2>Users</h2><p>Error loading users: ${error.message}</p>`;
      }
    };

    window.loadAdmins = async function () {
      const main = document.getElementById("main");
      main.innerHTML = "<h2>Admins</h2><p>Loading admin accounts...</p>";

      try {
        const usersRef = collection(db, "users");
        const snapshot = await getDocs(usersRef);

        let html = "<h2>Admins</h2><table><tr><th>Name</th><th>Email</th><th>Actions</th></tr>";

        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          if (data.role === "admin") {
            html += `<tr>
                <td>${data.name || "Unknown"}</td>
                <td>${data.email || "N/A"}</td>
                <td><button onclick="removeAdmin('${docSnap.id}')">Remove Admin</button></td>
              </tr>`;
          }
        });

        html += "</table>";
        main.innerHTML = html;

      } catch (error) {
        main.innerHTML = `<h2>Admins</h2><p>Error: ${error.message}</p>`;
      }
    };

    window.removeAdmin = async function (userId) {
      if (!confirm("Are you sure you want to remove admin rights?")) return;

      try {
        const userDoc = doc(db, "users", userId);
        await updateDoc(userDoc, { role: "user" });
        alert("Admin rights removed.");
        loadAdmins();
      } catch (error) {
        alert("Error: " + error.message);
      }
    };

    window.loadRecords = function () {
      document.getElementById("main").innerHTML = "<h2>Records</h2><p>Patient records will appear here...</p>";
    };

    window.loadCritical = function () {
      document.getElementById("main").innerHTML = "<h2>Critical</h2><p>Critical health alerts...</p>";
    };

    window.loadComments = async function () {
      const main = document.getElementById("main");
      main.innerHTML = "<h2>Comments</h2><p>Loading comments...</p>";

      try {
        const commentsRef = collection(db, "comments");
        const snapshot = await getDocs(commentsRef);

        if (snapshot.empty) {
          main.innerHTML = "<h2>Comments</h2><p>No comments found.</p>";
          return;
        }

        let html = "<h2>Comments</h2><table><tr><th>User</th><th>Comment</th><th>Timestamp</th></tr>";
        snapshot.forEach(doc => {
          const data = doc.data();
          const timestamp = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleString() : "N/A";
          html += `<tr><td>${data.user || "Anonymous"}</td><td>${data.text || ""}</td><td>${timestamp}</td></tr>`;
        });
        html += "</table>";
        main.innerHTML = html;

      } catch (error) {
        main.innerHTML = `<h2>Comments</h2><p>Error: ${error.message}</p>`;
      }
    };

    window.logout = function () {
      alert("Logging out...");
    };

    window.toggleSidebar = function () {
      document.getElementById("sidenav").classList.toggle("active");
    };

    window.switchSection = function (loadFunction) {
      document.getElementById("sidenav").classList.remove("active");
      loadFunction();
    };
  </script>
</body>

</html>
